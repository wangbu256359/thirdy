{"version":3,"file":"request.js","names":["dateDocumentBecameVisible","trackDateDocumentBecameVisible","isBrowser","Date","now","document","hidden","addEventListener","formatError","sdk","error","Error","AuthApiError","errorSummary","message","resp","err","serverErr","responseText","isString","JSON","parse","e","status","options","transformErrorXHR","clone","wwwAuthHeader","WWWAuthError","getWWWAuthenticateHeader","headers","error_description","OAuthError","wwwAuthErr","parseHeader","max_age","acr_values","parameters","errorCauses","errorDescription","scheme","httpRequest","httpRequestInterceptors","interceptor","url","method","args","saveAuthnState","accessToken","withCredentials","storageUtil","storage","httpCache","storageManager","getHttpCache","cookies","pollingIntent","pollDelay","cacheResponse","cacheContents","getStorage","cachedResponse","expiresAt","Promise","resolve","response","oktaUserAgentHeader","_oktaUserAgent","getHttpHeader","Object","assign","removeNils","ajaxOptions","data","undefined","res","promise","waitForVisibleAndAwakenDocument","waitForAwakenDocument","recursiveFetch","retryCount","timeSinceDocumentIsVisible","setTimeout","pageVisibilityHandler","removeEventListener","retryableFetch","httpRequestClient","catch","isNetworkError","IOS_MAX_RETRY_COUNT","then","Array","isArray","forEach","item","stateToken","delete","STATE_TOKEN_KEY_NAME","set","updateStorage","Math","floor","DEFAULT_CACHE_DURATION","errorCode","get","isAbsoluteUrl","getIssuerOrigin","getOptions","post","postOptions"],"sources":["../../../lib/http/request.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\n/* eslint-disable complexity */\nimport { isString, clone, isAbsoluteUrl, removeNils } from '../util';\nimport {\n  STATE_TOKEN_KEY_NAME,\n  DEFAULT_CACHE_DURATION,\n  IOS_MAX_RETRY_COUNT,\n} from '../constants';\nimport {\n  OktaAuthHttpInterface,\n  RequestOptions,\n  FetchOptions,\n  RequestData,\n  HttpResponse\n} from './types';\nimport { AuthApiError, OAuthError, APIError, WWWAuthError } from '../errors';\nimport { isBrowser } from '../features';\n\n\n// For iOS track last date when document became visible\nlet dateDocumentBecameVisible = 0;\nlet trackDateDocumentBecameVisible: () => void;\nif (isBrowser()) {\n  dateDocumentBecameVisible = Date.now();\n  trackDateDocumentBecameVisible = () => {\n    if (!document.hidden) {\n      dateDocumentBecameVisible = Date.now();\n    }\n  };\n  document.addEventListener('visibilitychange', trackDateDocumentBecameVisible);\n}\n\nconst formatError = (sdk: OktaAuthHttpInterface, error: HttpResponse | Error): AuthApiError | OAuthError => {\n  if (error instanceof Error) {\n    // fetch() can throw exceptions\n    // see https://developer.mozilla.org/en-US/docs/Web/API/fetch#exceptions\n    return new AuthApiError({\n      errorSummary: error.message,\n    });\n  }\n\n  let resp: HttpResponse = error;\n  let err: AuthApiError | OAuthError | WWWAuthError;\n  let serverErr: Record<string, any> = {};\n  if (resp.responseText && isString(resp.responseText)) {\n    try {\n      serverErr = JSON.parse(resp.responseText);\n    } catch (e) {\n      serverErr = {\n        errorSummary: 'Unknown error'\n      };\n    }\n  }\n\n  if (resp.status >= 500) {\n    serverErr.errorSummary = 'Unknown error';\n  }\n\n  if (sdk.options.transformErrorXHR) {\n    resp = sdk.options.transformErrorXHR(clone(resp));\n  }\n\n  // \n  const wwwAuthHeader = WWWAuthError.getWWWAuthenticateHeader(resp?.headers) ?? '';\n\n  if (serverErr.error && serverErr.error_description) {\n    err = new OAuthError(serverErr.error, serverErr.error_description, resp);\n  } else {\n    err = new AuthApiError(serverErr as APIError, resp, { wwwAuthHeader });\n  }\n\n  if (wwwAuthHeader && resp?.status >= 400 && resp?.status < 500) {\n    const wwwAuthErr = WWWAuthError.parseHeader(wwwAuthHeader);\n    // check for 403 to avoid breaking change\n    if (resp.status === 403 && wwwAuthErr?.error === 'insufficient_authentication_context') {\n      // eslint-disable-next-line camelcase\n      const { max_age, acr_values } = wwwAuthErr.parameters;\n      err = new AuthApiError(\n        {\n          errorSummary: wwwAuthErr.error,\n          errorCauses: [{ errorSummary: wwwAuthErr.errorDescription }]\n        },\n        resp,\n        {\n          // eslint-disable-next-line camelcase\n          max_age: +max_age,\n          // eslint-disable-next-line camelcase\n          ...(acr_values && { acr_values })\n        }\n      );\n    }\n    else if (wwwAuthErr?.scheme === 'DPoP') {\n      err = wwwAuthErr;\n    }\n    // else {\n    //   // WWWAuthError.parseHeader may return null, only overwrite if !null\n    //   err = wwwAuthErr ?? err;\n    // }\n  }\n\n  return err;\n};\n\n// eslint-disable-next-line max-statements\nexport function httpRequest(sdk: OktaAuthHttpInterface, options: RequestOptions): Promise<any> {\n  options = options || {};\n\n  if (sdk.options.httpRequestInterceptors) {\n    for (const interceptor of sdk.options.httpRequestInterceptors) {\n      interceptor(options);\n    }\n  }\n\n  var url = options.url,\n      method = options.method,\n      args = options.args,\n      saveAuthnState = options.saveAuthnState,\n      accessToken = options.accessToken,\n      withCredentials = options.withCredentials === true, // default value is false\n      storageUtil = sdk.options.storageUtil,\n      storage = storageUtil!.storage,\n      httpCache = sdk.storageManager.getHttpCache(sdk.options.cookies),\n      pollingIntent = options.pollingIntent,\n      pollDelay = sdk.options.pollDelay ?? 0;\n\n  if (options.cacheResponse) {\n    var cacheContents = httpCache.getStorage();\n    var cachedResponse = cacheContents[url as string];\n    if (cachedResponse && Date.now()/1000 < cachedResponse.expiresAt) {\n      return Promise.resolve(cachedResponse.response);\n    }\n  }\n\n  var oktaUserAgentHeader = sdk._oktaUserAgent.getHttpHeader();\n  var headers: HeadersInit = {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json',\n    ...oktaUserAgentHeader\n  };\n  Object.assign(headers, sdk.options.headers, options.headers);\n  headers = removeNils(headers) as HeadersInit;\n\n  if (accessToken && isString(accessToken)) {\n    headers['Authorization'] = 'Bearer ' + accessToken;\n  }\n\n  var ajaxOptions: FetchOptions = {\n    headers,\n    data: args || undefined,\n    withCredentials\n  };\n\n  var err, res, promise;\n\n  if (pollingIntent && isBrowser() && pollDelay > 0) {\n    let waitForVisibleAndAwakenDocument: () => Promise<void>;\n    let waitForAwakenDocument: () => Promise<void>;\n    let recursiveFetch: () => Promise<HttpResponse>;\n    let retryCount = 0;\n\n    // Safari on iOS has a bug:\n    //  Performing `fetch` right after document became visible can fail with `Load failed` error.\n    // Running fetch after short timeout fixes this issue.\n    waitForAwakenDocument = () => {\n      const timeSinceDocumentIsVisible = Date.now() - dateDocumentBecameVisible;\n      if (timeSinceDocumentIsVisible < pollDelay) {\n        return new Promise<void>((resolve) => setTimeout(() => {\n          if (!document.hidden) {\n            resolve();\n          } else {\n            resolve(waitForVisibleAndAwakenDocument());\n          }\n        }, pollDelay - timeSinceDocumentIsVisible));\n      } else {\n        return Promise.resolve();\n      }\n    };\n\n    // Returns a promise that resolves when document is visible for 500 ms\n    waitForVisibleAndAwakenDocument = () => {\n      if (document.hidden) {\n        let pageVisibilityHandler: () => void;\n        return new Promise<void>((resolve) => {\n          pageVisibilityHandler = () => {\n            if (!document.hidden) {\n              document.removeEventListener('visibilitychange', pageVisibilityHandler);\n              resolve(waitForAwakenDocument());\n            }\n          };\n          document.addEventListener('visibilitychange', pageVisibilityHandler);\n        });\n      } else {\n        return waitForAwakenDocument();\n      }\n    };\n\n    // Restarts fetch on 'Load failed' error\n    // This error can occur when `fetch` does not respond\n    //  (due to CORS error, non-existing host, or network error)\n    const retryableFetch = (): Promise<HttpResponse> => {\n      return sdk.options.httpRequestClient!(method!, url!, ajaxOptions).catch((err) => {\n        const isNetworkError = err?.message === 'Load failed';\n        if (isNetworkError && retryCount < IOS_MAX_RETRY_COUNT) {\n          retryCount++;\n          return recursiveFetch();\n        }\n        throw err;\n      });\n    };\n\n    // Final promise to fetch that wraps logic with waiting for visible document\n    //  and retrying fetch request on network error\n    recursiveFetch = (): Promise<HttpResponse> => {\n      return waitForVisibleAndAwakenDocument().then(retryableFetch);\n    };\n\n    promise = recursiveFetch();\n  } else {\n    promise = sdk.options.httpRequestClient!(method!, url!, ajaxOptions);\n  }\n\n  return promise\n    .then(function(resp) {\n      res = resp.responseText;\n      if (res && isString(res)) {\n        res = JSON.parse(res);\n        if (res && typeof res === 'object' && !res.headers) {\n          if (Array.isArray(res)) {\n            res.forEach(item => {\n              item.headers = resp.headers;\n            });\n          } else {\n            res.headers = resp.headers;\n          }\n        }\n      }\n\n      if (saveAuthnState) {\n        if (!res.stateToken) {\n          storage.delete(STATE_TOKEN_KEY_NAME);\n        }\n      }\n\n      if (res && res.stateToken && res.expiresAt) {\n        storage.set(STATE_TOKEN_KEY_NAME, res.stateToken, res.expiresAt, sdk.options.cookies!);\n      }\n\n      if (res && options.cacheResponse) {\n        httpCache.updateStorage(url!, {\n          expiresAt: Math.floor(Date.now()/1000) + DEFAULT_CACHE_DURATION,\n          response: res\n        });\n      }\n      \n      return res;\n    })\n    .catch(function(resp) {\n      err = formatError(sdk, resp);\n\n      if (err.errorCode === 'E0000011') {\n        storage.delete(STATE_TOKEN_KEY_NAME);\n      }\n\n      throw err;\n    });\n}\n\nexport function get(sdk: OktaAuthHttpInterface, url: string, options?: RequestOptions) {\n  url = isAbsoluteUrl(url) ? url : sdk.getIssuerOrigin() + url;\n  var getOptions = {\n    url: url,\n    method: 'GET'\n  };\n  Object.assign(getOptions, options);\n  return httpRequest(sdk, getOptions);\n}\n\nexport function post(sdk: OktaAuthHttpInterface, url: string, args?: RequestData, options?: RequestOptions) {\n  url = isAbsoluteUrl(url) ? url : sdk.getIssuerOrigin() + url;\n  var postOptions = {\n    url: url,\n    method: 'POST',\n    args: args,\n    saveAuthnState: true\n  };\n  Object.assign(postOptions, options);\n  return httpRequest(sdk, postOptions);\n}\n"],"mappings":";;;;;AAeA;AACA;AAYA;AACA;AA7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAkBA;AACA,IAAIA,yBAAyB,GAAG,CAAC;AACjC,IAAIC,8BAA0C;AAC9C,IAAI,IAAAC,mBAAS,GAAE,EAAE;EACfF,yBAAyB,GAAGG,IAAI,CAACC,GAAG,EAAE;EACtCH,8BAA8B,GAAG,MAAM;IACrC,IAAI,CAACI,QAAQ,CAACC,MAAM,EAAE;MACpBN,yBAAyB,GAAGG,IAAI,CAACC,GAAG,EAAE;IACxC;EACF,CAAC;EACDC,QAAQ,CAACE,gBAAgB,CAAC,kBAAkB,EAAEN,8BAA8B,CAAC;AAC/E;AAEA,MAAMO,WAAW,GAAG,CAACC,GAA0B,EAAEC,KAA2B,KAAgC;EAC1G,IAAIA,KAAK,YAAYC,KAAK,EAAE;IAC1B;IACA;IACA,OAAO,IAAIC,oBAAY,CAAC;MACtBC,YAAY,EAAEH,KAAK,CAACI;IACtB,CAAC,CAAC;EACJ;EAEA,IAAIC,IAAkB,GAAGL,KAAK;EAC9B,IAAIM,GAA6C;EACjD,IAAIC,SAA8B,GAAG,CAAC,CAAC;EACvC,IAAIF,IAAI,CAACG,YAAY,IAAI,IAAAC,cAAQ,EAACJ,IAAI,CAACG,YAAY,CAAC,EAAE;IACpD,IAAI;MACFD,SAAS,GAAGG,IAAI,CAACC,KAAK,CAACN,IAAI,CAACG,YAAY,CAAC;IAC3C,CAAC,CAAC,OAAOI,CAAC,EAAE;MACVL,SAAS,GAAG;QACVJ,YAAY,EAAE;MAChB,CAAC;IACH;EACF;EAEA,IAAIE,IAAI,CAACQ,MAAM,IAAI,GAAG,EAAE;IACtBN,SAAS,CAACJ,YAAY,GAAG,eAAe;EAC1C;EAEA,IAAIJ,GAAG,CAACe,OAAO,CAACC,iBAAiB,EAAE;IACjCV,IAAI,GAAGN,GAAG,CAACe,OAAO,CAACC,iBAAiB,CAAC,IAAAC,WAAK,EAACX,IAAI,CAAC,CAAC;EACnD;;EAEA;EACA,MAAMY,aAAa,GAAGC,oBAAY,CAACC,wBAAwB,CAACd,IAAI,EAAEe,OAAO,CAAC,IAAI,EAAE;EAEhF,IAAIb,SAAS,CAACP,KAAK,IAAIO,SAAS,CAACc,iBAAiB,EAAE;IAClDf,GAAG,GAAG,IAAIgB,kBAAU,CAACf,SAAS,CAACP,KAAK,EAAEO,SAAS,CAACc,iBAAiB,EAAEhB,IAAI,CAAC;EAC1E,CAAC,MAAM;IACLC,GAAG,GAAG,IAAIJ,oBAAY,CAACK,SAAS,EAAcF,IAAI,EAAE;MAAEY;IAAc,CAAC,CAAC;EACxE;EAEA,IAAIA,aAAa,IAAIZ,IAAI,EAAEQ,MAAM,IAAI,GAAG,IAAIR,IAAI,EAAEQ,MAAM,GAAG,GAAG,EAAE;IAC9D,MAAMU,UAAU,GAAGL,oBAAY,CAACM,WAAW,CAACP,aAAa,CAAC;IAC1D;IACA,IAAIZ,IAAI,CAACQ,MAAM,KAAK,GAAG,IAAIU,UAAU,EAAEvB,KAAK,KAAK,qCAAqC,EAAE;MACtF;MACA,MAAM;QAAEyB,OAAO;QAAEC;MAAW,CAAC,GAAGH,UAAU,CAACI,UAAU;MACrDrB,GAAG,GAAG,IAAIJ,oBAAY,CACpB;QACEC,YAAY,EAAEoB,UAAU,CAACvB,KAAK;QAC9B4B,WAAW,EAAE,CAAC;UAAEzB,YAAY,EAAEoB,UAAU,CAACM;QAAiB,CAAC;MAC7D,CAAC,EACDxB,IAAI,EACJ;QACE;QACAoB,OAAO,EAAE,CAACA,OAAO;QACjB;QACA,IAAIC,UAAU,IAAI;UAAEA;QAAW,CAAC;MAClC,CAAC,CACF;IACH,CAAC,MACI,IAAIH,UAAU,EAAEO,MAAM,KAAK,MAAM,EAAE;MACtCxB,GAAG,GAAGiB,UAAU;IAClB;IACA;IACA;IACA;IACA;EACF;;EAEA,OAAOjB,GAAG;AACZ,CAAC;;AAED;AACO,SAASyB,WAAW,CAAChC,GAA0B,EAAEe,OAAuB,EAAgB;EAC7FA,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;EAEvB,IAAIf,GAAG,CAACe,OAAO,CAACkB,uBAAuB,EAAE;IACvC,KAAK,MAAMC,WAAW,IAAIlC,GAAG,CAACe,OAAO,CAACkB,uBAAuB,EAAE;MAC7DC,WAAW,CAACnB,OAAO,CAAC;IACtB;EACF;EAEA,IAAIoB,GAAG,GAAGpB,OAAO,CAACoB,GAAG;IACjBC,MAAM,GAAGrB,OAAO,CAACqB,MAAM;IACvBC,IAAI,GAAGtB,OAAO,CAACsB,IAAI;IACnBC,cAAc,GAAGvB,OAAO,CAACuB,cAAc;IACvCC,WAAW,GAAGxB,OAAO,CAACwB,WAAW;IACjCC,eAAe,GAAGzB,OAAO,CAACyB,eAAe,KAAK,IAAI;IAAE;IACpDC,WAAW,GAAGzC,GAAG,CAACe,OAAO,CAAC0B,WAAW;IACrCC,OAAO,GAAGD,WAAW,CAAEC,OAAO;IAC9BC,SAAS,GAAG3C,GAAG,CAAC4C,cAAc,CAACC,YAAY,CAAC7C,GAAG,CAACe,OAAO,CAAC+B,OAAO,CAAC;IAChEC,aAAa,GAAGhC,OAAO,CAACgC,aAAa;IACrCC,SAAS,GAAGhD,GAAG,CAACe,OAAO,CAACiC,SAAS,IAAI,CAAC;EAE1C,IAAIjC,OAAO,CAACkC,aAAa,EAAE;IACzB,IAAIC,aAAa,GAAGP,SAAS,CAACQ,UAAU,EAAE;IAC1C,IAAIC,cAAc,GAAGF,aAAa,CAACf,GAAG,CAAW;IACjD,IAAIiB,cAAc,IAAI1D,IAAI,CAACC,GAAG,EAAE,GAAC,IAAI,GAAGyD,cAAc,CAACC,SAAS,EAAE;MAChE,OAAOC,OAAO,CAACC,OAAO,CAACH,cAAc,CAACI,QAAQ,CAAC;IACjD;EACF;EAEA,IAAIC,mBAAmB,GAAGzD,GAAG,CAAC0D,cAAc,CAACC,aAAa,EAAE;EAC5D,IAAItC,OAAoB,GAAG;IACzB,QAAQ,EAAE,kBAAkB;IAC5B,cAAc,EAAE,kBAAkB;IAClC,GAAGoC;EACL,CAAC;EACDG,MAAM,CAACC,MAAM,CAACxC,OAAO,EAAErB,GAAG,CAACe,OAAO,CAACM,OAAO,EAAEN,OAAO,CAACM,OAAO,CAAC;EAC5DA,OAAO,GAAG,IAAAyC,gBAAU,EAACzC,OAAO,CAAgB;EAE5C,IAAIkB,WAAW,IAAI,IAAA7B,cAAQ,EAAC6B,WAAW,CAAC,EAAE;IACxClB,OAAO,CAAC,eAAe,CAAC,GAAG,SAAS,GAAGkB,WAAW;EACpD;EAEA,IAAIwB,WAAyB,GAAG;IAC9B1C,OAAO;IACP2C,IAAI,EAAE3B,IAAI,IAAI4B,SAAS;IACvBzB;EACF,CAAC;EAED,IAAIjC,GAAG,EAAE2D,GAAG,EAAEC,OAAO;EAErB,IAAIpB,aAAa,IAAI,IAAAtD,mBAAS,GAAE,IAAIuD,SAAS,GAAG,CAAC,EAAE;IACjD,IAAIoB,+BAAoD;IACxD,IAAIC,qBAA0C;IAC9C,IAAIC,cAA2C;IAC/C,IAAIC,UAAU,GAAG,CAAC;;IAElB;IACA;IACA;IACAF,qBAAqB,GAAG,MAAM;MAC5B,MAAMG,0BAA0B,GAAG9E,IAAI,CAACC,GAAG,EAAE,GAAGJ,yBAAyB;MACzE,IAAIiF,0BAA0B,GAAGxB,SAAS,EAAE;QAC1C,OAAO,IAAIM,OAAO,CAAQC,OAAO,IAAKkB,UAAU,CAAC,MAAM;UACrD,IAAI,CAAC7E,QAAQ,CAACC,MAAM,EAAE;YACpB0D,OAAO,EAAE;UACX,CAAC,MAAM;YACLA,OAAO,CAACa,+BAA+B,EAAE,CAAC;UAC5C;QACF,CAAC,EAAEpB,SAAS,GAAGwB,0BAA0B,CAAC,CAAC;MAC7C,CAAC,MAAM;QACL,OAAOlB,OAAO,CAACC,OAAO,EAAE;MAC1B;IACF,CAAC;;IAED;IACAa,+BAA+B,GAAG,MAAM;MACtC,IAAIxE,QAAQ,CAACC,MAAM,EAAE;QACnB,IAAI6E,qBAAiC;QACrC,OAAO,IAAIpB,OAAO,CAAQC,OAAO,IAAK;UACpCmB,qBAAqB,GAAG,MAAM;YAC5B,IAAI,CAAC9E,QAAQ,CAACC,MAAM,EAAE;cACpBD,QAAQ,CAAC+E,mBAAmB,CAAC,kBAAkB,EAAED,qBAAqB,CAAC;cACvEnB,OAAO,CAACc,qBAAqB,EAAE,CAAC;YAClC;UACF,CAAC;UACDzE,QAAQ,CAACE,gBAAgB,CAAC,kBAAkB,EAAE4E,qBAAqB,CAAC;QACtE,CAAC,CAAC;MACJ,CAAC,MAAM;QACL,OAAOL,qBAAqB,EAAE;MAChC;IACF,CAAC;;IAED;IACA;IACA;IACA,MAAMO,cAAc,GAAG,MAA6B;MAClD,OAAO5E,GAAG,CAACe,OAAO,CAAC8D,iBAAiB,CAAEzC,MAAM,EAAGD,GAAG,EAAG4B,WAAW,CAAC,CAACe,KAAK,CAAEvE,GAAG,IAAK;QAC/E,MAAMwE,cAAc,GAAGxE,GAAG,EAAEF,OAAO,KAAK,aAAa;QACrD,IAAI0E,cAAc,IAAIR,UAAU,GAAGS,8BAAmB,EAAE;UACtDT,UAAU,EAAE;UACZ,OAAOD,cAAc,EAAE;QACzB;QACA,MAAM/D,GAAG;MACX,CAAC,CAAC;IACJ,CAAC;;IAED;IACA;IACA+D,cAAc,GAAG,MAA6B;MAC5C,OAAOF,+BAA+B,EAAE,CAACa,IAAI,CAACL,cAAc,CAAC;IAC/D,CAAC;IAEDT,OAAO,GAAGG,cAAc,EAAE;EAC5B,CAAC,MAAM;IACLH,OAAO,GAAGnE,GAAG,CAACe,OAAO,CAAC8D,iBAAiB,CAAEzC,MAAM,EAAGD,GAAG,EAAG4B,WAAW,CAAC;EACtE;EAEA,OAAOI,OAAO,CACXc,IAAI,CAAC,UAAS3E,IAAI,EAAE;IACnB4D,GAAG,GAAG5D,IAAI,CAACG,YAAY;IACvB,IAAIyD,GAAG,IAAI,IAAAxD,cAAQ,EAACwD,GAAG,CAAC,EAAE;MACxBA,GAAG,GAAGvD,IAAI,CAACC,KAAK,CAACsD,GAAG,CAAC;MACrB,IAAIA,GAAG,IAAI,OAAOA,GAAG,KAAK,QAAQ,IAAI,CAACA,GAAG,CAAC7C,OAAO,EAAE;QAClD,IAAI6D,KAAK,CAACC,OAAO,CAACjB,GAAG,CAAC,EAAE;UACtBA,GAAG,CAACkB,OAAO,CAACC,IAAI,IAAI;YAClBA,IAAI,CAAChE,OAAO,GAAGf,IAAI,CAACe,OAAO;UAC7B,CAAC,CAAC;QACJ,CAAC,MAAM;UACL6C,GAAG,CAAC7C,OAAO,GAAGf,IAAI,CAACe,OAAO;QAC5B;MACF;IACF;IAEA,IAAIiB,cAAc,EAAE;MAClB,IAAI,CAAC4B,GAAG,CAACoB,UAAU,EAAE;QACnB5C,OAAO,CAAC6C,MAAM,CAACC,+BAAoB,CAAC;MACtC;IACF;IAEA,IAAItB,GAAG,IAAIA,GAAG,CAACoB,UAAU,IAAIpB,GAAG,CAACb,SAAS,EAAE;MAC1CX,OAAO,CAAC+C,GAAG,CAACD,+BAAoB,EAAEtB,GAAG,CAACoB,UAAU,EAAEpB,GAAG,CAACb,SAAS,EAAErD,GAAG,CAACe,OAAO,CAAC+B,OAAO,CAAE;IACxF;IAEA,IAAIoB,GAAG,IAAInD,OAAO,CAACkC,aAAa,EAAE;MAChCN,SAAS,CAAC+C,aAAa,CAACvD,GAAG,EAAG;QAC5BkB,SAAS,EAAEsC,IAAI,CAACC,KAAK,CAAClG,IAAI,CAACC,GAAG,EAAE,GAAC,IAAI,CAAC,GAAGkG,iCAAsB;QAC/DrC,QAAQ,EAAEU;MACZ,CAAC,CAAC;IACJ;IAEA,OAAOA,GAAG;EACZ,CAAC,CAAC,CACDY,KAAK,CAAC,UAASxE,IAAI,EAAE;IACpBC,GAAG,GAAGR,WAAW,CAACC,GAAG,EAAEM,IAAI,CAAC;IAE5B,IAAIC,GAAG,CAACuF,SAAS,KAAK,UAAU,EAAE;MAChCpD,OAAO,CAAC6C,MAAM,CAACC,+BAAoB,CAAC;IACtC;IAEA,MAAMjF,GAAG;EACX,CAAC,CAAC;AACN;AAEO,SAASwF,GAAG,CAAC/F,GAA0B,EAAEmC,GAAW,EAAEpB,OAAwB,EAAE;EACrFoB,GAAG,GAAG,IAAA6D,mBAAa,EAAC7D,GAAG,CAAC,GAAGA,GAAG,GAAGnC,GAAG,CAACiG,eAAe,EAAE,GAAG9D,GAAG;EAC5D,IAAI+D,UAAU,GAAG;IACf/D,GAAG,EAAEA,GAAG;IACRC,MAAM,EAAE;EACV,CAAC;EACDwB,MAAM,CAACC,MAAM,CAACqC,UAAU,EAAEnF,OAAO,CAAC;EAClC,OAAOiB,WAAW,CAAChC,GAAG,EAAEkG,UAAU,CAAC;AACrC;AAEO,SAASC,IAAI,CAACnG,GAA0B,EAAEmC,GAAW,EAAEE,IAAkB,EAAEtB,OAAwB,EAAE;EAC1GoB,GAAG,GAAG,IAAA6D,mBAAa,EAAC7D,GAAG,CAAC,GAAGA,GAAG,GAAGnC,GAAG,CAACiG,eAAe,EAAE,GAAG9D,GAAG;EAC5D,IAAIiE,WAAW,GAAG;IAChBjE,GAAG,EAAEA,GAAG;IACRC,MAAM,EAAE,MAAM;IACdC,IAAI,EAAEA,IAAI;IACVC,cAAc,EAAE;EAClB,CAAC;EACDsB,MAAM,CAACC,MAAM,CAACuC,WAAW,EAAErF,OAAO,CAAC;EACnC,OAAOiB,WAAW,CAAChC,GAAG,EAAEoG,WAAW,CAAC;AACtC"}